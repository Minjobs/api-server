<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MURDOO K - ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-overlay: rgba(0, 0, 0, 0.6); 
            --point-gold: #ffd700;
            --text-white: #ffffff;
            --card-white: #ffffff;
            --btn-disabled: #444444;
            --text-disabled: #888888;
            --error-red: #ff4757;
        }
        body { margin: 0; padding: 0; background: #000; font-family: 'Kanit', sans-serif; color: #fff; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .background-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-image: url('/background.jpg'); background-size: cover; opacity: 0.7; }
        
        .container { 
            width: 90%; max-width: 400px; 
            margin: 30px 0 10px 0; 
            background: var(--bg-overlay); 
            border-radius: 30px; 
            padding: 30px 20px; 
            border: 2px solid rgba(255,215,0,0.3); 
            text-align: center; 
            backdrop-filter: blur(15px); 
            box-sizing: border-box; 
        }
        
        .qr-card { background: var(--card-white); border-radius: 25px; padding: 20px; margin: 20px 0; color: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .qr-card img.qr-main { width: 100%; border-radius: 15px; margin-bottom: 15px; }
        .item-info { font-size: 1.2rem; font-weight: 700; color: #1a1a1a; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .price-display { font-size: 1.8rem; font-weight: 700; color: #d32f2f; margin: 5px 0; }
        .receiver-info { font-size: 0.85rem; color: #666; margin-top: 8px; border-top: 1px solid #eee; padding-top: 8px; }

        .steps { text-align: left; background: rgba(255,255,255,0.05); padding: 18px; border-radius: 20px; margin-bottom: 25px; }
        .step-item { font-size: 0.85rem; margin-bottom: 10px; display: flex; gap: 10px; line-height: 1.4; opacity: 0.9; }
        .step-num { background: var(--point-gold); color: #000; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0; font-size: 0.75rem; }

        .upload-area { margin-bottom: 25px; }
        #slipInput { display: none; }
        .upload-label { display: block; background: rgba(255,215,0,0.1); border: 2px dashed var(--point-gold); padding: 15px; border-radius: 15px; cursor: pointer; color: var(--point-gold); font-weight: 500; transition: 0.3s; }
        
        #previewContainer { margin-top: 15px; position: relative; display: none; }
        #slipPreview { width: 100%; max-height: 250px; object-fit: contain; border-radius: 15px; border: 2px solid var(--point-gold); box-shadow: 0 0 15px rgba(255,215,0,0.3); }
        .preview-tag { position: absolute; top: 10px; left: 10px; background: var(--point-gold); color: #000; padding: 2px 8px; border-radius: 5px; font-size: 0.7rem; font-weight: 700; }

        .btn { width: 100%; padding: 18px; border-radius: 20px; border: none; font-weight: 700; font-size: 1.1rem; cursor: pointer; transition: 0.4s; }
        .btn-main { background: var(--btn-disabled); color: var(--text-disabled); cursor: not-allowed; pointer-events: none; }
        .btn-main.active { background: linear-gradient(135deg, var(--point-gold), #f57c00); color: #000; box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4); cursor: pointer; pointer-events: auto; }

        .hidden { display: none; }
        footer { width: 100%; text-align: center; padding: 20px 0; font-size: 0.75rem; opacity: 0.6; font-weight: 300; }
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    
    <div class="container">
        <div id="paymentUI">
            <h2 style="color: var(--point-gold); margin-bottom: 5px; font-weight: 700;">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Checkout)</h2>
            <p style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 20px;">‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</p>

            <div class="qr-card">
                <div class="item-info">
                    <span id="coinAmountText">--</span> 
                    <span style="font-size: 1.4rem;">ü™ô</span> 
                </div>
                <div class="price-display" id="bahtAmount">-- THB</div>
                <img src="/qrcode.jpg" class="qr-main" alt="PromptPay QR">
                <div class="receiver-info">‡∏ú‡∏π‡πâ‡∏£‡∏ò‡∏±‡∏ç‡∏ç‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏°‡∏á‡∏Ñ‡∏•‡∏£‡∏±‡∏ï‡∏ô‡∏°‡∏ì‡∏µtPay)</div>
            </div>

            <div class="steps">
                <div class="step-item"><div class="step-num">1</div><span><b>‡∏™‡πÅ‡∏Å‡∏ô:</b> ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span></div>
                <div class="step-item"><div class="step-num">2</div><span><b>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</b> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span></div>
                <div class="step-item"><div class="step-num">3</div><span><b>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</b> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</span></div>
            </div>

            <div class="upload-area">
                <input type="file" id="slipInput" accept="image/*" onchange="handleFileSelect(this)">
                <label for="slipInput" class="upload-label" id="uploadLabel">üì∏ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ</label>
                
                <div id="previewContainer">
                    <span class="preview-tag">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span>
                    <img id="slipPreview" src="" alt="Slip Preview">
                </div>
            </div>

            <button class="btn btn-main" id="verifyBtn" onclick="processPayment()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç</button>
        </div>

        <div id="successUI" class="hidden">
            <div style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
            <h2 style="color: var(--point-gold);">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß<br>‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
            <button class="btn btn-main active" onclick="location.href='/'" style="margin-top: 20px;">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏π‡∏î‡∏ß‡∏á</button>
        </div>

        <div id="errorUI" class="hidden">
            <div style="font-size: 4rem; margin-bottom: 20px;">‚ö†Ô∏è</div>
            <h2 style="color: var(--error-red);">‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</h2>
            <p id="errorMsg">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <button class="btn btn-main active" onclick="location.href='/'" style="margin-top: 20px; background: #555;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>
    </div>

    <footer>¬© 2026 MURDOO K. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏´‡πà‡∏á‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤</footer>

    <script>
        const API_KEY = 'wodmfjc8202oj4tnguf9wo2k2jrnjdwow0011k2k2n3nfnnfndsiow901o2kkemrx999dej3j';
        const transactionId = window.location.pathname.split('/').pop();

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const payRes = await fetch(`/api/payment/detail/${transactionId}`, { headers: { 'x-api-key': API_KEY } });
                
                if (!payRes.ok) {
                    const errData = await payRes.json();
                    throw new Error(errData.message || "Invalid Access");
                }

                const payData = await payRes.json();
                document.getElementById('coinAmountText').innerText = `${payData.coin_amount} ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç`;
                document.getElementById('bahtAmount').innerText = `${payData.baht_amount} THB`;

            } catch (err) {
                console.error("Access Error:", err);
                document.getElementById('paymentUI').classList.add('hidden');
                document.getElementById('errorUI').classList.remove('hidden');
            }
        });

        function handleFileSelect(input) {
            const file = input.files[0];
            const previewContainer = document.getElementById('previewContainer');
            const previewImg = document.getElementById('slipPreview');
            const verifyBtn = document.getElementById('verifyBtn');
            const uploadLabel = document.getElementById('uploadLabel');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    previewContainer.style.display = 'block';
                    verifyBtn.classList.add('active');
                    uploadLabel.innerText = "‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û";
                }
                reader.readAsDataURL(file);
            } else {
                previewContainer.style.display = 'none';
                verifyBtn.classList.remove('active');
            }
        }

        async function processPayment() {
            const fileInput = document.getElementById('slipInput');
            const btn = document.getElementById('verifyBtn');

            if (!fileInput.files[0]) {
                alert("üì∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ");
                return;
            }

            btn.disabled = true;
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";

            const formData = new FormData();
            formData.append('slip', fileInput.files[0]);
            formData.append('transactionId', transactionId);

            try {
                const res = await fetch('/api/payment/verify-slip', {
                    method: 'POST',
                    headers: { 'x-api-key': API_KEY },
                    body: formData
                });

                const result = await res.json();

                if (res.ok) {
                    document.getElementById('paymentUI').classList.add('hidden');
                    document.getElementById('successUI').classList.remove('hidden');
                } else {
                    let message = "";
                    switch (result.code) {
                        case 'SLIPOK_1014':
                        case 'INVALID_RECEIVER':
                            message = "‚ùå ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ THANYAPHAT M ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà";
                            break;
                        case 'SLIPOK_1009':
                        case 'BANK_MAINTENANCE':
                            message = "‚è≥ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß\n‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 15 ‡∏ô‡∏≤‡∏ó‡∏µ";
                            break;
                        case 'DUPLICATE_SLIP':
                            message = "üö´ ‡∏™‡∏•‡∏¥‡∏õ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏ö‡πÉ‡∏´‡∏°‡πà";
                            break;
                        case 'SLIPOK_1002':
                            message = "üîë ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö";
                            break;
                        default:
                            message = `‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.error}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì`;
                    }
                    alert(message);
                    btn.disabled = false;
                    btn.innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç";
                }
            } catch (e) {
                alert("üöÄ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
                btn.disabled = false;
                btn.innerText = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç";
            }
        }
    </script>
</body>
</html>
