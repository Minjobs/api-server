<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MURDOO K - ‡∏ú‡∏•‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏î‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-overlay: rgba(0, 0, 0, 0.6); 
            --point-gold: #b8860b;
            --paper-bg: #fffaf0; /* ÎëêÎ£®ÎßàÎ¶¨ Ï¢ÖÏù¥ÏÉâ */
            --text-dark: #2c1b15;
        }

        body {
            margin: 0; padding: 0; background-color: #fff; /* ÏãúÏûëÏùÄ ÌïòÏñóÍ≤å */
            font-family: 'Kanit', sans-serif; color: var(--text-dark);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow-x: hidden;
            animation: whiteToBg 1.5s ease-in-out forwards;
        }

        /* ÌïòÏñÄ ÌôîÎ©¥ÏóêÏÑú Î∞∞Í≤ΩÏúºÎ°ú Ï†ÑÌôòÎêòÎäî Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes whiteToBg {
            from { background-color: #fff; }
            to { background-color: #1a120b; }
        }

        .background-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background-image: url('/background.jpg'); background-size: cover; background-position: center;
            opacity: 0; animation: fadeIn 2s 1s forwards;
        }
        .background-blur {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            backdrop-filter: blur(10px) brightness(0.6); opacity: 0; animation: fadeIn 2s 1s forwards;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .container {
            width: 90%; max-width: 440px; margin: 40px 0;
            perspective: 1000px;
        }

        /* --- [Í≤∞Í≥º ÎëêÎ£®ÎßàÎ¶¨ ÎîîÏûêÏù∏] --- */
        .result-scroll {
            background: var(--paper-bg);
            border-radius: 5px;
            padding: 40px 25px;
            box-sizing: border-box;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8), inset 0 0 100px rgba(139,69,19,0.1);
            position: relative;
            transform-origin: top;
            animation: scrollOpen 1.2s 0.5s cubic-bezier(0.17, 0.67, 0.83, 0.67) both;
            border-left: 15px solid #8b4513; border-right: 15px solid #8b4513; /* ÎÇòÎ¨¥ Ï∂ï ÎäêÎÇå */
        }

        @keyframes scrollOpen {
            from { transform: scaleY(0); opacity: 0; }
            to { transform: scaleY(1); opacity: 1; }
        }

        header { text-align: center; margin-bottom: 30px; }
        .logo { font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; color: #8b4513; font-weight: 800; }
        
        .fortune-badge {
            display: inline-block; padding: 5px 15px; background: #8b4513; color: #fff;
            font-size: 0.8rem; border-radius: 20px; margin-bottom: 15px; text-transform: uppercase;
        }

        .summary-text {
            font-size: 1.4rem; font-weight: 700; line-height: 1.5; color: #2c1b15;
            margin-bottom: 30px; text-align: center; border-bottom: 2px solid rgba(139,69,19,0.2);
            padding-bottom: 20px;
        }

        /* ÏÑπÏÖò Ïä§ÌÉÄÏùº */
        .detail-section { margin-bottom: 25px; text-align: left; }
        .section-title {
            font-size: 1.1rem; font-weight: 700; color: #8b4513;
            margin-bottom: 10px; display: flex; align-items: center; gap: 8px;
        }
        .section-content {
            font-size: 0.95rem; line-height: 1.8; color: #4e342e; font-weight: 400;
            white-space: pre-wrap;
        }

        /* Ïï°ÏÖò Î≤ÑÌäº */
        .btn-group { display: flex; flex-direction: column; gap: 12px; margin-top: 40px; width: 100%; }
        .btn {
            padding: 16px; border-radius: 12px; border: none; font-family: 'Kanit';
            font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .btn-again { background: #8b4513; color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-share { background: transparent; border: 2px solid #8b4513; color: #8b4513; }

        .hidden { display: none !important; }

        /* Î°úÎî© ÏÉÅÌÉú (API ÎåÄÍ∏∞ Ï§ë) */
        #apiLoader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; background: #fffaf0;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #f3f3f3;
            border-top: 4px solid #8b4513; border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="apiLoader">
        <div class="spinner"></div>
        <p style="margin-top: 15px; color: #8b4513;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏±‡∏°‡∏†‡∏µ‡∏£‡πå‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤...</p>
    </div>

    <div class="background-overlay"></div>
    <div class="background-blur"></div>

    <div class="container hidden" id="resultContent">
        <div class="result-scroll">
            <header>
                <div class="fortune-badge">Fortune Scroll</div>
                <div class="logo">MURDOO <span>K</span></div>
            </header>

            <main>
                <div class="summary-text" id="summary">...</div>

                <div id="details">
                    </div>

                <div class="btn-group">
                    <button class="btn btn-again" onclick="location.href='/gacha'">‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (Draw Again)</button>
                    <button class="btn btn-share" onclick="shareResult()">‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤ (Share)</button>
                </div>
            </main>
        </div>
    </div>

    <script>
        const API_KEY = 'wodmfjc8202oj4tnguf9wo2k2jrnjdwow0011k2k2n3nfnnfndsiow901o2kkemrx999dej3j';
        
        const labelMap = {
            outward: "üé≠ ‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å",
            inward: "üß† ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏à‡∏¥‡∏ï‡πÉ‡∏à",
            strengths: "üåü ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
            weaknesses: "‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á",
            cautions: "üö´ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á",
            boosters: "‚ú® ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á"
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const pathParts = window.location.pathname.split('/');
            const resultId = pathParts[pathParts.length - 1];

            try {
                const response = await fetch(`/api/fortune/result/${resultId}`, {
                    headers: { 'x-api-key': API_KEY }
                });
                
                if (!response.ok) throw new Error("Result not found");
                const data = await response.json();

                // Îç∞Ïù¥ÌÑ∞ Îß§Ìïë
                document.getElementById('summary').innerText = data.summary;
                
                const detailsContainer = document.getElementById('details');
                Object.keys(labelMap).forEach(key => {
                    if (data.details[key]) {
                        const section = document.createElement('div');
                        section.className = 'detail-section';
                        section.innerHTML = `
                            <div class="section-title">${labelMap[key]}</div>
                            <div class="section-content">${data.details[key]}</div>
                        `;
                        detailsContainer.appendChild(section);
                    }
                });

                // ÌôîÎ©¥ ÌëúÏãú
                document.getElementById('apiLoader').classList.add('hidden');
                document.getElementById('resultContent').classList.remove('hidden');

            } catch (err) {
                console.error(err);
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
                location.href = '/gacha';
            }
        });

        function shareResult() {
            if (navigator.share) {
                navigator.share({
                    title: 'MURDOO K - ‡∏î‡∏ß‡∏á‡∏ä‡∏∞‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô',
                    text: '‡∏°‡∏≤‡∏î‡∏π‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏î‡∏ß‡∏á‡∏ä‡∏∞‡∏ï‡∏≤‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏™‡∏¥!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
            }
        }
    </script>
</body>
</html>
