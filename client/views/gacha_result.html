<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MURDOO K - ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;700&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --wood-dark: #3e2723;
            --wood-medium: #5d4037;
            --metal-brass: #b5a642;
            --point-gold: #b8860b;
            --paper-bg: #fffaf0;
            --text-dark: #2c1b15;
        }

        body {
            margin: 0; padding: 0; background-color: #0a0a0a;
            font-family: 'Kanit', sans-serif; color: var(--text-dark);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; overflow-x: hidden;
        }

        /* --- [Î∞∞Í≤Ω ÏÑ§Ï†ï] --- */
        .background-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background-image: url('/background.jpg'); background-size: cover; background-position: center;
        }
        .background-blur {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            backdrop-filter: blur(12px) brightness(0.5); background: rgba(0,0,0,0.4);
        }

        /* --- [ÏÉÅÎã® SAJU Î°úÍ≥†] --- */
        .top-logo-link {
            text-decoration: none;
            margin-top: 20px;
            z-index: 10;
        }
        .top-logo-text {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--point-gold);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
            letter-spacing: 2px;
        }

        /* --- [Î°úÎî© Î†àÏù¥Ïñ¥] --- */
        #loadingLayer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10000;
        }

        .mini-machine-bottom {
            width: 160px; height: 100px;
            background: linear-gradient(to bottom, var(--wood-medium), var(--wood-dark));
            border: 6px solid var(--wood-dark); border-radius: 20px 20px 10px 10px;
            position: relative; display: flex; justify(content): center;
            z-index: 5;
        }

        .dispenser-slot {
            width: 80px; height: 40px; background: #1a0f0a;
            border: 4px solid var(--metal-brass); border-radius: 8px 8px 0 0;
            border-bottom: none; position: absolute; bottom: 0; 
            overflow: hidden;
        }

        .exit-ball {
            position: absolute; top: -50px; left: 50%;
            width: 40px; height: 40px; background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b);
            border-radius: 50%; transform: translateX(-50%);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            z-index: 10;
        }

        .drop-anim { animation: ballDrop 0.3s ease-in forwards; }
        @keyframes ballDrop {
            0% { top: -50px; }
            100% { top: 5px; }
        }

        .zoom-anim { 
            animation: ballZoom 1s ease-in-out forwards; 
            z-index: 10001;
        }
        @keyframes ballZoom {
            0% { transform: translate(-50%, 0) scale(1); top: 5px; }
            100% { transform: translate(-50%, -120%) scale(calc(70vw / 40)); top: 50%; }
        }

        .container {
            width: 92%; max-width: 440px; margin: 20px 0 40px 0;
            display: none;
            z-index: 10;
        }

        .result-scroll {
            background: var(--paper-bg); padding: 40px 25px; border-radius: 4px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            border-left: 12px solid #5d4037; border-right: 12px solid #5d4037;
        }

        .date-text { text-align: center; color: #8b4513; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500; }
        .score-box { text-align: center; margin-bottom: 25px; }
        .score-bar-bg { width: 100%; height: 8px; background: #ddd; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .score-bar-fill { width: 0; height: 100%; background: var(--point-gold); transition: width 1s; }

        .summary-title { font-size: 1.4rem; font-weight: 800; text-align: center; color: #5d4037; margin-bottom: 25px; line-height: 1.4; }

        .section { margin-bottom: 25px; border-bottom: 1px dashed rgba(0,0,0,0.1); padding-bottom: 15px; }
        .section-title { font-weight: 700; color: #8b4513; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        
        .section-content { 
            font-size: 0.95rem; line-height: 1.7; color: #333; 
            text-align: left; 
            word-break: break-word; 
        }

        /* --- [üî• ÌñâÏö¥Ïùò Ïà´Ïûê Í≥®Îì†Î≥º Ïä§ÌÉÄÏùº] --- */
        .lucky-numbers-container {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
        }
        .golden-ball {
            width: 60px; height: 60px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b, #8b4513);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 800; font-size: 1.1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3), inset -2px -2px 6px rgba(0,0,0,0.4);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            animation: ballFloat 2s infinite ease-in-out;
        }
        @keyframes ballFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .lucky-box {
            background: rgba(184, 134, 11, 0.1); border: 1.5px solid var(--point-gold);
            padding: 15px; border-radius: 10px; margin-top: 20px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .lucky-item { text-align: center; }
        .lucky-label { font-size: 0.75rem; color: #8b4513; margin-bottom: 4px; }
        .lucky-value { font-weight: 700; font-size: 1.1rem; }

        .btn { 
            width: 100%; padding: 16px; border-radius: 12px; border: none; 
            font-family: 'Kanit'; font-weight: 700; font-size: 1.1rem; 
            cursor: pointer; transition: 0.2s;
        }
        .btn-home { background: #5d4037; color: white; margin-top: 30px; }
        .btn-main { background: #8b4513; color: white; margin-top: 10px; } 
    </style>
</head>
<body>

    <div class="background-overlay"></div>
    <div class="background-blur"></div>

    <a href="/" class="top-logo-link">
        <div class="top-logo-text">SAJU</div>
    </a>

    <div id="loadingLayer">
        <div class="mini-machine-bottom">
            <div class="dispenser-slot" id="dispenserSlot">
                <div class="exit-ball" id="gachaBall"></div>
            </div>
        </div>
        <p id="loadingStatus" style="color: gold; margin-top: 40px; font-weight: 500; opacity: 0.8;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡∏•‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢...</p>
    </div>

    <div class="container" id="resultContent">
        <div class="result-scroll">
            <div class="date-text" id="analysis_date">üìÖ Î°úÎî©Ï§ë...</div>
            <div class="score-box">
                <div style="font-size: 2.5rem; font-weight: 800; color: var(--point-gold);" id="score">0</div>
                <div style="font-size: 0.8rem; color: #8b4513;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="score-bar-bg"><div class="score-bar-fill" id="scoreBar"></div></div>
            </div>

            <div class="summary-title" id="summary">...</div>

            <div class="section">
                <div class="section-title">üîÆ ‡∏î‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
                <div class="section-content" id="today_luck"></div>
            </div>

            <div class="section" style="text-align: center;">
                <div class="section-title" style="justify-content: center;">üçÄ ‡πÄ‡∏•‡∏Ç‡∏ô‡∏≥‡πÇ‡∏ä‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Lucky Numbers)</div>
                <div class="lucky-numbers-container" id="lucky_balls_container">
                    </div>
            </div>

            <div class="section">
                <div class="section-title">üêæ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£</div>
                <div class="section-content" id="zodiac_advice"></div>
            </div>

            <div class="section">
                <div class="section-title">üèÉ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏ô</div>
                <div class="section-content" id="action_plan"></div>
            </div>

            <div class="section" style="border: none;">
                <div class="section-title">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á</div>
                <div class="section-content" id="cautions"></div>
            </div>

            <div class="lucky-box">
                <div class="lucky-item" style="grid-column: span 2;">
                    <div class="lucky-label">‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á & ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á</div>
                    <div class="lucky-value" id="lucky_items_combined">?</div>
                </div>
            </div>

            <button class="btn btn-home" onclick="location.href='/gacha'">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
            <button class="btn btn-main" onclick="location.href='/'">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button> 
        </div>
    </div>

    <script>
        const API_KEY = 'wodmfjc8202oj4tnguf9wo2k2jrnjdwow0011k2k2n3nfnnfndsiow901o2kkemrx999dej3j';

        document.addEventListener('DOMContentLoaded', async () => {
            const startTime = Date.now();
            const resultId = window.location.pathname.split('/').pop();
            const gachaBall = document.getElementById('gachaBall');
            const dispenserSlot = document.getElementById('dispenserSlot');
            
            setTimeout(() => { gachaBall.classList.add('drop-anim'); }, 500);

            const dataPromise = fetch(`/api/gacha/result/${resultId}`, {
                headers: { 'x-api-key': API_KEY }
            }).then(res => res.json());

            setTimeout(() => {
                dispenserSlot.style.overflow = 'visible'; 
                gachaBall.classList.remove('drop-anim');
                gachaBall.classList.add('zoom-anim');
                document.getElementById('loadingStatus').style.display = 'none';
            }, 800);

            try {
                const data = await dataPromise;

                // ÌÖçÏä§Ìä∏ Îß§Ìïë
                document.getElementById('analysis_date').innerText = `üìÖ ${data.analysis_date} | ‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î ‡∏û.‡∏®. ${data.user_year_be}`;
                document.getElementById('score').innerText = data.today_luck_score;
                document.getElementById('summary').innerText = data.summary;
                document.getElementById('today_luck').innerText = data.today_luck;
                document.getElementById('zodiac_advice').innerText = data.zodiac_advice;
                document.getElementById('action_plan').innerText = data.action_plan;
                document.getElementById('cautions').innerText = data.cautions;
                
                // ‚úÖ ÏïÑÏù¥ÌÖúÍ≥º Í∏àÍ∏∞ ÏÇ¨Ìï≠ Í≤∞Ìï© ÎÖ∏Ï∂ú
                document.getElementById('lucky_items_combined').innerText = `${data.lucky_items} / ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á: ${data.taboo}`;

                // ‚úÖ ÌñâÏö¥Ïùò Ïà´Ïûê(Î∞∞Ïó¥)Î•º Í≥®Îì†Î≥ºÎ°ú ÏÉùÏÑ±
                const ballContainer = document.getElementById('lucky_balls_container');
                if (data.lucky_numbers && Array.isArray(data.lucky_numbers)) {
                    data.lucky_numbers.slice(0, 3).forEach(num => {
                        const ball = document.createElement('div');
                        ball.className = 'golden-ball';
                        ball.innerText = num;
                        ballContainer.appendChild(ball);
                    });
                }

                const elapsed = Date.now() - startTime;
                const waitTime = Math.max(0, 1800 - elapsed);

                setTimeout(() => {
                    document.getElementById('loadingLayer').style.display = 'none';
                    document.getElementById('resultContent').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('scoreBar').style.width = data.today_luck_score + '%';
                    }, 100);
                }, waitTime);

            } catch (err) {
                console.error(err);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                location.href = '/gacha';
            }
        });
    </script>
</body>
</html>
