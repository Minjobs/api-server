<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MURDOO K - à¹€à¸¥à¸·à¸­à¸à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¹à¸«à¹ˆà¸‡à¹‚à¸Šà¸„à¸Šà¸°à¸•à¸²</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Niramit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/home.css">
    <style>
        /* ... ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ ... */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
        .user-nav { display: flex; align-items: center; gap: 15px; }

        .profile-container {
            width: 46px; height: 46px; border-radius: 50%; overflow: hidden;
            border: 2px solid #ffd700; cursor: pointer; transition: 0.3s;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
        }

        /* [ì¶”ê°€] ìš”ì†Œ ìˆ¨ê¹€ìš© í´ë˜ìŠ¤ */
        .hidden { display: none !important; }

        .profile-container img { width: 100%; height: 100%; object-fit: cover; }
        
        #loginBtn {
            background: linear-gradient(45deg, #ffd700, #ffae00);
            color: #000; border: none; padding: 8px 18px; border-radius: 20px;
            font-weight: 700; cursor: pointer;
        }
        /* ... ì¹´í…Œê³ ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ ë“± ë‚˜ë¨¸ì§€ ë™ì¼ ... */
    </style>
</head>
<body>
    <div class="magic-background">
        <div class="magic-ring ring-1"></div>
        <div class="magic-ring ring-2"></div>
        <div class="magic-runes">âœ¨ ğŸ”® ğŸŒ™ â˜€ï¸ ğŸŒŸ ğŸŒ€ ğŸ•¯ï¸ ğŸŒ€ ğŸŒŸ â˜€ï¸ ğŸŒ™ ğŸ”® âœ¨</div>
    </div>

    <div class="container">
        <header>
            <div class="logo">âœ¨ MURDOO K</div>
            <div class="user-nav">
                <div class="profile-container hidden" id="profileBox" onclick="location.href='/profile'">
                    <img id="userProfileImg" src="https://www.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png" alt="Profile">
                </div>
                <button id="loginBtn" class="hidden" onclick="location.href='/login'">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
            </div>
        </header>

        <main>
            <div style="text-align: center; margin-bottom: 45px; margin-top: 20px;">
                <h2 style="font-family: 'Cinzel Decorative'; color: white; font-size: 1.8rem; margin-bottom: 10px;">à¹€à¸¥à¸·à¸­à¸à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¹à¸«à¹ˆà¸‡à¹‚à¸Šà¸„à¸Šà¸°à¸•à¸²</h2>
                <p style="color: #aaa;">à¹€à¸¥à¸·à¸­à¸à¸«à¸±à¸§à¸‚à¹‰à¸­à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰à¸”à¸§à¸‡à¸”à¸²à¸§à¸™à¸³à¸—à¸²à¸‡</p>
            </div>

            <div class="category-grid">
                <div class="category-card" onclick="handleCategoryClick('personality')">
                    <span class="category-icon">ğŸ­</span>
                    <h3>Personality</h3>
                    <p>à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸•à¸±à¸§à¸•à¸™à¸—à¸µà¹ˆà¹à¸—à¹‰à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸¸à¸“</p>
                </div>
                <div class="category-card" onclick="handleCategoryClick('wealth')">
                    <span class="category-icon">ğŸ’°</span>
                    <h3>Wealth</h3>
                    <p>à¸•à¸£à¸§à¸ˆà¹€à¸Šà¹‡à¸à¸”à¸§à¸‡à¸à¸²à¸£à¹€à¸‡à¸´à¸™à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸¡à¸±à¹ˆà¸‡à¸„à¸±à¹ˆà¸‡</p>
                </div>
                <div class="category-card" onclick="handleCategoryClick('romance')">
                    <span class="category-icon">â¤ï¸</span>
                    <h3>Romance</h3>
                    <p>à¸„à¹‰à¸™à¸«à¸²à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¹à¸«à¹ˆà¸‡à¸„à¸§à¸²à¸¡à¸£à¸±à¸à¹à¸¥à¸°à¹€à¸™à¸·à¹‰à¸­à¸„à¸¹à¹ˆ</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        let isLoggedIn = false;

        document.addEventListener('DOMContentLoaded', async () => {
            const profileBox = document.getElementById('profileBox');
            const loginBtn = document.getElementById('loginBtn');
            const profileImg = document.getElementById('userProfileImg');
            
            const initUser = async () => {
                try {
                    // [ì²´í¬!] ì„œë²„ .envì˜ API_KEYì™€ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
                    const API_KEY = 'wodmfjc8202oj4tnguf9wo2k2jrnjdwow0011k2k2n3nfnnfndsiow901o2kkemrx999dej3j';
                    
                    const res = await fetch('/api/user/profile', {
                        headers: { 'x-api-key': API_KEY }
                    });

                    if (res.ok) {
                        const user = await res.json();
                        console.log("âœ… ìœ ì € ì •ë³´ ë¡œë“œ ì„±ê³µ:", user);
                        
                        const googleAvatar = 'https://www.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png';
                        
                        // ë°ì´í„°ê°€ nullì´ë©´ êµ¬ê¸€ ì•„ë°”íƒ€ ì‚¬ìš©
                        profileImg.src = user.profile_img || googleAvatar;
                        
                        // ìƒì ë³´ì—¬ì£¼ê¸°
                        profileBox.classList.remove('hidden');
                        loginBtn.classList.add('hidden');
                        isLoggedIn = true;
                    } else {
                        console.warn("âš ï¸ ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ì‚¬ìš©ì (í˜¹ì€ API Key ì˜¤ë¥˜)");
                        loginBtn.classList.remove('hidden');
                        profileBox.classList.add('hidden');
                        isLoggedIn = false;
                    }
                } catch (err) {
                    console.error("âŒ í”„ë¡œí•„ ë¡œë“œ ì—ëŸ¬:", err);
                    loginBtn.classList.remove('hidden');
                    isLoggedIn = false;
                }
            };

            await initUser();
        });

        function handleCategoryClick(category) {
            if (!isLoggedIn) {
                if(confirm("à¸à¸£à¸¸à¸“à¸²à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¸à¹ˆà¸­à¸™à¹€à¸à¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸”à¸§à¸‡à¸Šà¸°à¸•à¸²à¸‚à¸­à¸‡à¸„à¸¸à¸“")) {
                    window.location.href = '/login';
                }
            } else {
                window.location.href = `/${category}`;
            }
        }
    </script>
</body>
</html>
