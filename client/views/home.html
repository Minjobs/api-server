<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MURDOO K - à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸«à¹ˆà¸‡à¹‚à¸Šà¸„à¸Šà¸°à¸•à¸²</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Niramit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/home.css">
    <style>
        /* [ìˆ˜ì •] í—¤ë” ë° í”„ë¡œí•„ ì „ìš© ìŠ¤íƒ€ì¼ */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .user-nav {
            display: flex;
            align-items: center;
        }

        /* í”„ë¡œí•„ ì‚¬ì§„ ì»¨í…Œì´ë„ˆ: ì´ì œ ìœ ì¼í•œ ë‚´ë¹„ê²Œì´ì…˜ ìš”ì†Œì…ë‹ˆë‹¤ */
        .profile-container {
            width: 48px; /* í¬ê¸°ë¥¼ ì•½ê°„ í‚¤ì›Œ ì¡´ì¬ê°ì„ ì¤¬ìŠµë‹ˆë‹¤ */
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #ffd700; 
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* í˜¸ë²„ ì‹œ ì‹ ë¹„ë¡œìš´ ê´‘ì±„ íš¨ê³¼ */
        .profile-container:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            border-color: #fff;
        }

        .profile-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>

    <div class="magic-background">
        <div class="magic-ring ring-1"></div>
        <div class="magic-ring ring-2"></div>
        <div class="magic-ring ring-3"></div>
        <div class="magic-runes">âœ¨ ğŸ”® ğŸŒ™ â˜€ï¸ ğŸŒŸ ğŸŒ€ ğŸ•¯ï¸ ğŸŒ€ ğŸŒŸ â˜€ï¸ ğŸŒ™ ğŸ”® âœ¨</div>
    </div>

    <div class="container">
        <header>
            <div class="logo">âœ¨ MURDOO K</div>
            <div class="user-nav">
                <div class="profile-container" onclick="location.href='/profile'" title="ë‚´ í”„ë¡œí•„ ë³´ê¸°">
                    <img id="userProfileImg" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Profile">
                </div>
            </div>
        </header>

        <main>
            <section class="glass-card">
                <h2>à¹€à¸›à¸´à¸”à¸›à¸£à¸°à¸•à¸¹à¹à¸«à¹ˆà¸‡à¹‚à¸Šà¸„à¸Šà¸°à¸•à¸²</h2>
                <p class="subtitle">à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸£à¸«à¸±à¸ªà¹à¸«à¹ˆà¸‡à¸”à¸§à¸‡à¸”à¸²à¸§à¸‚à¸­à¸‡à¸„à¸¸à¸“</p>

                <form id="fortuneForm">
                    <div class="input-row">
                        <div class="field">
                            <label>à¸Šà¸·à¹ˆà¸­à¸ˆà¸£à¸´à¸‡ (Real Name)</label>
                            <input type="text" id="realName" placeholder="à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸ˆà¸£à¸´à¸‡" required>
                        </div>
                        <div class="field">
                            <label>à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™ (Nickname)</label>
                            <input type="text" id="nickName" placeholder="à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™" required>
                        </div>
                    </div>

                    <div class="field">
                        <label>à¸§à¸±à¸™à¹€à¸”à¸·à¸­à¸™à¸›à¸µà¹€à¸à¸´à¸” (Date of Birth)</label>
                        <div class="dropdown-group dob-group">
                            <select id="birthDay" required><option value="" disabled selected>à¸§à¸±à¸™à¸—à¸µà¹ˆ</option></select>
                            <select id="birthMonth" required><option value="" disabled selected>à¹€à¸”à¸·à¸­à¸™</option>
                                <option value="01">à¸¡à¸à¸£à¸²à¸„à¸¡ (Jan)</option>
                                <option value="02">à¸à¸¸à¸¡à¸ à¸²à¸à¸±à¸™à¸˜à¹Œ (Feb)</option>
                                <option value="03">ë¯¸ë‚˜à¸„à¸¡ (Mar)</option>
                                <option value="04">ë©”ì‚¬ìš˜ (Apr)</option>
                                <option value="05">í”„ë¥´ì‚¬íŒŒì½¤ (May)</option>
                                <option value="06">ë¯¸íˆ¬ë‚˜ìš˜ (Jun)</option>
                                <option value="07">ê°€ë¼ê°€ë‹¤ì½¤ (Jul)</option>
                                <option value="08">ì‹±í•˜ì½¤ (Aug) </option>
                                <option value="09">ê¹ì•¼ìš˜ (Sep)</option>
                                <option value="10">ëš¤ë¼ì½¤ (Oct)</option>
                                <option value="11">í”„ë¥´ìŠ¤ì°Œê¹Œìš˜ (Nov)</option>
                                <option value="12">íƒ„ì™€ì½¤ (Dec)</option>
                            </select>
                            <select id="birthYear" required><option value="" disabled selected>à¸›à¸µ (à¸„.à¸¨.)</option></select>
                        </div>
                    </div>

                    <div class="field">
                        <label>à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸” (Birth Time)</label>
                        <div class="dropdown-group time-group">
                            <select id="birthHour" required><option value="" disabled selected>à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡</option></select>
                            <select id="birthMin" required><option value="" disabled selected>à¸™à¸²à¸—à¸µ</option></select>
                            <button type="button" id="unknownTimeBtn" class="unknown-btn">à¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¹€à¸§à¸¥à¸²</button>
                        </div>
                    </div>

                    <div class="field">
                        <label>à¹€à¸à¸¨ (Gender Identity)</label>
                        <select id="gender" required>
                            <option value="" disabled selected>ì„ íƒ</option>
                            <option value="male">à¸Šà¸²à¸¢ (Male)</option>
                            <option value="female">à¸«à¸à¸´à¸‡ (Female)</option>
                            <option value="tom">à¸—à¸­à¸¡ (Tom)</option>
                            <option value="ladyboy">à¸à¸°à¹€à¸—à¸¢ (Kathoey)</option>
                            <option value="gay">à¹€à¸à¸¢à¹Œ (Gay)</option>
                            <option value="lesbian">à¹€à¸¥ìŠ¤ë¹„ì–¸ (Lesbian)</option>
                            <option value="other">ê¸°íƒ€ (Other)</option>
                        </select>
                    </div>

                    <button type="submit" class="submit-btn">à¸”à¸¹à¸”à¸§à¸‡à¸•à¸­à¸™à¸™à¸µà¹‰</button>
                </form>
            </section>
        </main>

        <footer>
            <p>Â© 2026 MURDOO K. à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸«à¹ˆà¸‡à¹‚à¸Šà¸„à¸Šà¸°à¸•à¸²à¸—à¸µà¹ˆà¸–à¸¹à¸à¸¥à¸´à¸‚à¸´à¸•</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const profileImg = document.getElementById('userProfileImg');
            
            // [1] ìœ ì € ë°ì´í„° ë° í”„ë¡œí•„ ì´ë¯¸ì§€ ì´ˆê¸°í™”
            const initUser = async () => {
                try {
                    const res = await fetch('/api/user/profile', {
                        method: 'GET',
                        headers: {
                            // [ì£¼ì˜] ì‹¤ì œ ì„œë²„ API KEYë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
                            'x-api-key': 'wodmfjc8202oj4tnguf9wo2k2jrnjdwow0011k2k2n3nfnnfndsiow901o2kkemrx999dej3j',
                            'Content-Type': 'application/json'
                        }
                    });

                    if (res.ok) {
                        const user = await res.json();
                        const googleDefaultAvatar = 'https://www.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png';

                        profileImg.src = user.profile_img || googleDefaultAvatar;

                        profileImg.onerror = () => {
                            profileImg.src = googleDefaultAvatar;
                            profileImg.onerror = null;
                        };
                    } else {
                        console.error('ì¸ì¦ ì‹¤íŒ¨');
                        window.location.href = '/login';
                    }
                } catch (err) {
                    console.error('User Load Error:', err);
                }
            };

            await initUser();

            // --- í¼ ë¡œì§: ë“œë¡­ë‹¤ìš´ ìƒì„± ---
            const form = document.getElementById('fortuneForm');
            const daySel = document.getElementById('birthDay');
            const yearSel = document.getElementById('birthYear');
            const hourSel = document.getElementById('birthHour');
            const minSel = document.getElementById('birthMin');
            const monthSel = document.getElementById('birthMonth');
            const unknownBtn = document.getElementById('unknownTimeBtn');

            let isTimeUnknown = false;

            for (let i = 1; i <= 31; i++) daySel.add(new Option(i, i < 10 ? `0${i}` : i));
            const currentYear = new Date().getFullYear();
            for (let i = currentYear; i >= 1900; i--) yearSel.add(new Option(i, i));
            for (let i = 0; i < 24; i++) hourSel.add(new Option(i < 10 ? `0${i}` : i, i < 10 ? `0${i}` : i));
            for (let i = 0; i < 60; i++) minSel.add(new Option(i < 10 ? `0${i}` : i, i < 10 ? `0${i}` : i));

            // ì‹œê°„ ëª¨ë¦„ ë²„íŠ¼
            unknownBtn.addEventListener('click', () => {
                isTimeUnknown = !isTimeUnknown;
                const controls = [daySel, monthSel, yearSel, hourSel, minSel];
                if (isTimeUnknown) {
                    unknownBtn.classList.add('active');
                    controls.forEach(el => { el.selectedIndex = 0; el.disabled = true; el.style.opacity = '0.3'; });
                } else {
                    unknownBtn.classList.remove('active');
                    controls.forEach(el => { el.disabled = false; el.style.opacity = '1'; });
                }
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('ìœ„ëŒ€í•œ ìš´ëª…ì˜ ë¶„ì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤...');
            });
        });
    </script>
</body>
</html>
