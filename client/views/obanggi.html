<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MURDOO K - เสี่ยงทายธง 5 สี</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&family=Nanum+Myeongjo:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ✅ 유리 박스 배경색 조금 더 진하게 조정 */
            --bg-overlay: rgba(0, 0, 0, 0.65); 
            --point-gold: #ffd700;
            --point-red: #ff4757;
            --text-white: #ffffff;
            --border-line: rgba(255, 215, 0, 0.4); 
            --glow-gold: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        body {
            margin: 0; padding: 0;
            background-color: #050505;
            font-family: 'Kanit', sans-serif;
            color: var(--text-white);
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .background-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background-image: url('/background.jpg'); 
            background-size: cover; background-position: center;
            opacity: 0.5; 
        }

        .header-logo { margin-top: 25px; margin-bottom: 20px; z-index: 10; transition: 0.3s; cursor: pointer; }
        .header-logo img { height: 40px; }

        /* --- [메인 컨테이너 - 배경 유리 박스 적용] --- */
        .container {
            width: 90%; max-width: 440px;
            background-color: var(--bg-overlay);
            border-radius: 35px;
            padding: 35px 20px 45px 20px;
            box-sizing: border-box;
            backdrop-filter: blur(15px);
            border: 2px solid var(--border-line);
            text-align: center;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6);
            margin-bottom: 40px;
            z-index: 2;
        }

        .intro-text h1 { 
            font-family: 'Nanum Myeongjo', serif; 
            font-size: 1.9rem; color: var(--point-gold); 
            text-shadow: var(--glow-gold); margin: 0 0 10px 0; 
        }
        .intro-text p { font-size: 0.95rem; opacity: 0.8; font-weight: 300; line-height: 1.6; margin: 0 0 15px 0; }

        /* --- [깃발 애니메이션 스테이지 - 최적화] --- */
        .stage-wrapper {
            height: 280px; /* 높이 약간 조정 */
            display: flex; justify-content: center; align-items: center;
            position: relative;
            margin: 0 auto;
            width: 100%;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .flag-bundle {
            position: relative;
            width: 200px; height: 180px;
            transition: transform 0.1s;
        }

        .flag-img {
            position: absolute;
            width: 75px; height: auto;
            filter: drop-shadow(0 5px 12px rgba(0,0,0,0.6));
            transition: all 0.6s ease;
            transform-origin: bottom center;
        }

        /* 초기 부채꼴 배치 유지 */
        .flag-img:nth-child(1) { transform: translate(0, 0) rotate(0deg); z-index: 3; } 
        .flag-img:nth-child(2) { transform: translate(-35px, 10px) rotate(-15deg); z-index: 2; } 
        .flag-img:nth-child(3) { transform: translate(35px, 10px) rotate(15deg); z-index: 2; } 
        .flag-img:nth-child(4) { transform: translate(-65px, 25px) rotate(-30deg); z-index: 1; } 
        .flag-img:nth-child(5) { transform: translate(65px, 25px) rotate(30deg); z-index: 1; } 

        /* ✅ [수정] 섞기 애니메이션 - 부드럽고 천천히 */
        .shaking .flag-bundle {
            /* violent-shake 대신 gentle-mix 사용, 시간 1.5초로 대폭 늘림 */
            animation: gentle-mix 1.5s ease-in-out infinite;
        }
        .shaking .flag-img {
            left: 50%; top: 50%;
            margin-left: -37.5px; margin-top: -60px;
            transform: translate(0,0) rotate(0deg) !important;
            opacity: 0.8;
            filter: blur(1px); /* 천천히 섞일 때 약간의 잔상 효과 */
        }

        /* ✅ 부드러운 순환 모션 (어지럽지 않게) */
        @keyframes gentle-mix {
            0% { transform: rotate(0deg) translate(0px, 0px); }
            25% { transform: rotate(5deg) translate(-5px, 2px); }
            50% { transform: rotate(0deg) translate(0px, 5px); }
            75% { transform: rotate(-5deg) translate(5px, 2px); }
            100% { transform: rotate(0deg) translate(0px, 0px); }
        }

        /* --- [결과 카드 박스] --- */
        #result-display {
            display: none;
            flex-direction: column; align-items: center;
            padding: 10px 0;
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .result-stage {
            border: 2px solid var(--point-gold);
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 25px 15px;
            margin-bottom: 25px;
            width: 100%; box-sizing: border-box;
            box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.1);
        }

        .result-flag-img { 
            width: 130px; margin-bottom: 15px; 
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
            animation: result-float 3s ease-in-out infinite;
        }
        @keyframes result-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        .fate-title { font-size: 1.9rem; font-weight: 800; color: var(--point-gold); margin-bottom: 10px; line-height: 1.2; }
        .fate-desc { font-size: 1rem; font-weight: 300; line-height: 1.7; color: #eee; margin-bottom: 15px; }

        /* 검정 깃발(흉) 스타일 유지 */
        .bad-luck .result-stage {
            border-color: var(--point-red);
            box-shadow: inset 0 0 15px rgba(255, 71, 87, 0.2);
        }
        .bad-luck .fate-title { color: var(--point-red); }

        /* --- [버튼 디자인 유지 및 수정] --- */
        .action-btn {
            width: 80%; padding: 16px; border: none; border-radius: 40px;
            font-size: 1.2rem; font-weight: 700; cursor: pointer; font-family: 'Kanit';
            transition: all 0.2s;
            margin: 0 auto;
        }
        
        #shakeBtn {
            background: linear-gradient(135deg, var(--point-gold), #f57c00);
            color: #000;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
            margin-top: 15px;
        }
        #shakeBtn:active { transform: scale(0.96); }

        .retry-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.4); color: #ccc;
            width: auto; padding: 10px 30px; font-size: 0.95rem; margin-top: 0;
        }
        .retry-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }

        /* 흉(검정)일 때 액땜 버튼 */
        .aekdaem-btn { background: var(--point-red); color: white; box-shadow: 0 5px 20px rgba(255, 71, 87, 0.4); }

        .hidden { display: none !important; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        
        footer { text-align: center; margin-top: 15px; color: rgba(255,255,255,0.3); font-size: 0.75rem; z-index: 10; position: relative; }
    </style>
</head>
<body>

    <div class="background-overlay"></div>

    <audio id="sfx-shake" src="/sound/shake.mp3" loop></audio>
    <audio id="sfx-result" src="/sound/result.mp3"></audio>

    <header class="header-logo" onclick="location.href='/'">
        <img src="/textlogo.png" alt="MURDOO K">
    </header>

    <main class="container">
        <div id="ritual-view">
            <div class="intro-text">
                <h1>เสี่ยงทายธง 5 สี</h1>
                <p>ตั้งจิตใหม่อีกครั้ง นึกถึงเรื่องที่กังวล<br>แล้วเขย่าธงช้าๆ เพื่อขอคำชี้แนะ</p>
            </div>

            <div class="stage-wrapper" id="stage">
                <div class="flag-bundle" id="flagBundle">
                    <img src="/flag/flag_yellow.png" class="flag-img" alt="Yellow">
                    <img src="/flag/flag_blue.png" class="flag-img" alt="Blue">
                    <img src="/flag/flag_red.png" class="flag-img" alt="Red">
                    <img src="/flag/flag_white.png" class="flag-img" alt="White">
                    <img src="/flag/flag_black.png" class="flag-img" alt="Black">
                </div>
            </div>

            <button id="shakeBtn" class="action-btn" onclick="startRitual()">เขย่าธง (Shake)</button>
        </div>

        <div id="result-display">
            <div class="result-stage">
                <img src="" id="resImg" class="result-flag-img">
                <div class="fate-title" id="resTitle"></div>
                <div class="fate-desc" id="resDesc"></div>
            </div>
            
            <div id="btn-group-normal">
                <button class="action-btn retry-btn" onclick="location.reload()">อธิษฐานใหม่อีกครั้ง</button>
            </div>

            <div id="btn-group-bad" style="display:none;">
                <button class="action-btn aekdaem-btn" onclick="doAekDaem()">สะเดาะเคราะห์ (Ward off Bad Luck)</button>
                <button class="action-btn retry-btn" style="border: none;" onclick="closeResultView()">ยอมรับคำทำนาย</button>
            </div>
        </div>
    </main>

    <footer>© 2026 MURDOO K. บันทึกแห่งดวงดาว</footer>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // 오방기 해석 데이터 유지
        const flags = [
            { color: 'red', src: '/flag/flag_red.png', title: 'มหาโชค (Great Luck)', desc: 'ธงแดงแห่งชัยชนะ! สิ่งศักดิ시ทธิ์เปิดทางให้แล้ว สิ่งที่หวังจะสำเร็จอย่างรวดเร็วและยิ่งใหญ่ เป็นจังหวะที่ดีที่สุดในการลงมือทำ!', isBad: false },
            { color: 'white', src: '/flag/flag_white.png', title: 'เทพประทาน (Divine Blessing)', desc: 'ธงขาวแห่งความบริสุทธิ์! เทวดาคุ้มครองและชี้ทางสว่าง ปัญหาที่มืดมนจะคลี่คลาย จะมีผู้ใหญ่ 또는 กัลยาณมิตรยื่นมือเข้ามาช่วย', isBad: false },
            { color: 'yellow', src: '/flag/flag_yellow.png', title: 'ลาภบรรพบุรุษ (Ancestral Favor)', desc: 'ธงเหลืองแห่งบรรพชน! จะมีโชคลาภทางการเงิน 또는 ของกินเข้ามา แต่อย่าลืมทำบุญอุทิศส่วนกุศลให้เจ้าที่เจ้าทางแล้วจะดียิ่งขึ้น', isBad: false },
            { color: 'blue', src: '/flag/flag_blue.png', title: 'ลมแห่งการเปลี่ยนแปลง (Winds of Change)', desc: 'ธงเขียวแห่งลมพายุ! จิตใจว้าวุ่น 또는 มีเรื่องต้องเดินทาง/โยกย้าย ระวังความเครียด 및 อุบัติเหตุเล็กน้อย ให้ระวังคำพูดและอารมณ์', isBad: false },
            { color: 'black', src: '/flag/flag_black.png', title: 'เตือนภัย! (Warning)', desc: 'ธงดำแห่งความมืด... หยุดก่อน! ตอนนี้ไม่ใช่จังหวะที่ดี ระวังโดนหลอก ปัญหาสุขภาพ 또는 อุปสรรคใหญ่ อย่าเพิ่งเสี่ยงทำอะไรตอนนี้', isBad: true }
        ];

        const shakeBtn = document.getElementById('shakeBtn');
        const stage = document.getElementById('stage');
        const ritualView = document.getElementById('ritual-view');
        const resultDisplay = document.getElementById('result-display');
        
        const sfxShake = document.getElementById('sfx-shake');
        const sfxResult = document.getElementById('sfx-result');

        let isShaking = false;

        function startRitual() {
            if (isShaking) return;
            isShaking = true;

            shakeBtn.innerText = "กำลังสื่อสาร...";
            shakeBtn.disabled = true;
            stage.classList.add('shaking'); // 슬로우 모션 시작

            // ✅ [수정] 부드러운 진동 패턴으로 변경
            if (navigator.vibrate) navigator.vibrate([200, 300, 200, 300, 400]); 
            
            try { sfxShake.play().catch(() => {}); } catch(e){}

            // 천천히 섞이므로 대기 시간 약간 유지
            setTimeout(() => {
                stopRitual();
            }, 2500);
        }

        function stopRitual() {
            stage.classList.remove('shaking');
            try { 
                sfxShake.pause(); 
                sfxShake.currentTime = 0;
                sfxResult.play().catch(() => {}); 
            } catch(e){}

            // 결과 뽑기
            const result = flags[Math.floor(Math.random() * flags.length)];
            showResult(result);

            shakeBtn.disabled = false;
            isShaking = false;
        }

        function showResult(data) {
            // 의식 화면 숨기고 결과 화면 보여주기 (박스 내부에서 전환)
            ritualView.classList.add('hidden');
            resultDisplay.style.display = 'flex';

            document.getElementById('resImg').src = data.src;
            document.getElementById('resTitle').innerText = data.title;
            document.getElementById('resDesc').innerText = data.desc;

            // 흉(검정) 스타일에 따른 스타일링 유지
            const mainContainer = document.querySelector('.container');
            if (data.isBad) {
                mainContainer.classList.add('bad-luck');
                document.getElementById('btn-group-normal').style.display = 'none';
                document.getElementById('btn-group-bad').style.display = 'block';
            } else {
                mainContainer.classList.remove('bad-luck');
                document.getElementById('btn-group-normal').style.display = 'block';
                document.getElementById('btn-group-bad').style.display = 'none';
            }
        }

        // 결과창 닫고 다시 의식 화면으로 (새 질문)
        function closeResultView() {
            const mainContainer = document.querySelector('.container');
            mainContainer.classList.remove('bad-luck');
            resultDisplay.style.display = 'none';
            ritualView.classList.remove('hidden');
            shakeBtn.innerText = "เขย่าธง (Shake)";
        }

        // 액땜 로직 유지
        function doAekDaem() {
            Swal.fire({
                title: 'สะเดาะเคราะห์สำเร็จ!',
                text: ' 신령님께 위로의 기도를 전했습니다. 이제 โชคร้ายจะกลายเป็นดี.',
                icon: 'success',
                confirmButtonText: 'สาธุ (Amen)',
                confirmButtonColor: '#ff4757',
                background: '#1a1a1a',
                color: '#fff'
            }).then(() => {
                closeResultView();
            });
        }
    </script>
</body>
</html>
