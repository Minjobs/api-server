<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상품 상세내용</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .back-btn { padding: 10px; background: #eee; border: none; cursor: pointer; margin-bottom: 20px; }
        .product-img { width: 100%; max-width: 400px; border-radius: 10px; }
        .price { color: #fa622f; font-weight: bold; font-size: 1.5rem; }
    </style>
</head>
<body>
    <div id="app">
        <button class="back-btn" @click="goHome">← 목록으로 돌아가기</button>
        
        <div v-if="product">
            <img :src="product.img" class="product-img">
            <h1>{{ product.name }}</h1>
            <p class="price">{{ product.price.toLocaleString() }}원</p>
            <p>{{ product.desc }}</p>
            <button @click="buyProduct" style="padding: 15px; width: 100%; background: #000; color: #fff; border: none; border-radius: 5px; font-weight: bold;">구매하기</button>
        </div>
        <div v-else>
            <p>상품 정보를 불러오고 있습니다...</p>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const product = ref(null);

                onMounted(async () => {
                    // 1. 주소창에서 ID 숫자를 추출 (예: /product/1 -> 1)
                    const pathParts = window.location.pathname.split('/');
                    const productId = pathParts[pathParts.length - 1];

                    // 2. 서버의 API에 데이터 요청 (반드시 /api/... 로 시작)
                    try {
                        const response = await fetch(`/api/products/${productId}`);
                        if (!response.ok) throw new Error("데이터 없음");
                        product.value = await response.json();
                    } catch (err) {
                        alert("상품 정보를 불러오지 못했습니다.");
                        window.location.href = '/';
                    }
                });

                const goHome = () => window.location.href = '/';
                const buyProduct = () => alert("주문 페이지로 이동합니다.");

                return { product, goHome, buyProduct };
            }
        }).mount('#app');
    </script>
</body>
</html>
