<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>카톡 스타일 사다리타기</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --kakao-yellow: #FEE500; --kakao-brown: #3C1E1E; }
        body { font-family: sans-serif; margin: 0; background: #9bbbd4; overflow: hidden; }
        #app { display: flex; flex-direction: column; height: 100vh; }
        
        header { background: rgba(0,0,0,0.1); padding: 15px; text-align: center; color: white; font-weight: bold; }
        
        .setup-area { padding: 20px; text-align: center; background: white; }
        .setup-area input { width: 50px; padding: 10px; text-align: center; font-size: 18px; border: 1px solid #ccc; border-radius: 5px; }

        /* 사다리 캔버스 영역 */
        .ladder-container { flex: 1; position: relative; margin: 20px 0; }
        canvas { display: block; background: transparent; cursor: pointer; }

        /* 결과 입력 영역 */
        .input-row { display: flex; justify-content: space-around; padding: 10px 0; }
        .input-row input { width: 60px; border: none; background: white; border-radius: 5px; padding: 5px; text-align: center; font-size: 12px; }

        .btn-start { background: var(--kakao-brown); color: white; border: none; padding: 15px; width: 100%; font-size: 18px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div id="app">
        <header>사다리 타기</header>

        <div v-if="!isStarted" class="setup-area">
            <p>참여 인원</p>
            <button @click="count > 2 && count--">-</button>
            <input type="number" v-model="count" readonly>
            <button @click="count < 8 && count++">+</button>
            <div style="margin-top: 20px;">
                <button class="btn-start" @click="initLadder">사다리 만들기</button>
            </div>
        </div>

        <div v-show="isStarted" class="ladder-container" ref="container">
            <div class="input-row">
                <input v-for="i in count" :key="'u'+i" v-model="names[i-1]" placeholder="이름">
            </div>

            <canvas ref="canvas"></canvas>

            <div class="input-row">
                <input v-for="i in count" :key="'d'+i" v-model="results[i-1]" placeholder="결과">
            </div>
            
            <button class="btn-start" @click="startAnimation" v-if="!animating">결과 확인</button>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, nextTick } = Vue;
        createApp({
            setup() {
                const count = ref(3);
                const isStarted = ref(false);
                const animating = ref(false);
                const names = ref([]);
                const results = ref([]);
                const canvas = ref(null);
                const container = ref(null);
                let ctx, width, height, ladderData = [];

                const initLadder = () => {
                    isStarted.ref = true;
                    names.value = Array(count.value).fill('').map((_, i) => `인원${i+1}`);
                    results.value = Array(count.value).fill('').map((_, i) => `꽝`);
                    isStarted.value = true;
                    nextTick(() => drawBaseLadder());
                };

                const drawBaseLadder = () => {
                    const c = canvas.value;
                    ctx = c.getContext('2d');
                    width = container.value.clientWidth;
                    height = container.value.clientHeight - 100;
                    c.width = width;
                    c.height = height;

                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 4;
                    
                    const step = width / (count.value + 1);
                    ladderData = [];

                    // 세로선 그리기 및 데이터 생성
                    for (let i = 1; i <= count.value; i++) {
                        const x = step * i;
                        ctx.beginPath();
                        ctx.moveTo(x, 10);
                        ctx.lineTo(x, height - 10);
                        ctx.stroke();
                        ladderData.push({ x, lines: [] });
                    }

                    // 가로선 랜덤 생성
                    for (let i = 0; i < count.value - 1; i++) {
                        let y = 50;
                        while (y < height - 50) {
                            y += Math.floor(Math.random() * 50) + 30;
                            if (y > height - 50) break;
                            
                            const x1 = ladderData[i].x;
                            const x2 = ladderData[i+1].x;
                            
                            ctx.beginPath();
                            ctx.moveTo(x1, y);
                            ctx.lineTo(x2, y);
                            ctx.stroke();
                            
                            ladderData[i].lines.push({ y, to: i + 1 });
                            ladderData[i+1].lines.push({ y, to: i - 1 });
                        }
                    }
                };

                const startAnimation = () => {
                    alert('하나씩 클릭해서 결과를 확인하세요!');
                    animating.value = true;
                };

                return { count, isStarted, names, results, canvas, container, initLadder, startAnimation, animating };
            }
        }).mount('#app');
    </script>
</body>
</html>
